"use strict";var cellular;var retryUpdate;var columnCount=1;var sterGrid;var GRIDSIZE=200;var GUTTERSIZE=10;var victim;var populator;var returnEmail;var returnPass;var signingUp=false;var signingIn=false;var signupCount=0;var externalStartUpIndex;var $theFace;var $theFaceOrigPos;var theContainer=document.getElementById("ng-app");var addFlag;var hoodie=new Hoodie();window.hoodie=hoodie;var lazyUpdater=_.debounce(function(b){for(var a in cellular){if(cellular[a].id===b){hoodie.store.update("cell",cellular[a].id,{dimensions:cellular[a].dimensions});hoodie.store.update("cell",cellular[a].id,{title:cellular[a].title});hoodie.store.update("cell",cellular[a].id,{category:cellular[a].category});hoodie.store.update("cell",cellular[a].id,{body:cellular[a].body}).done(function(c){console.log(c);console.log(b+" LAZILY UPDATED");addFlag=c.id})}}},1000);var analyzr=function(){$.ajax({type:"POST",dataType:"JSON",data:{project:which},url:"php/analyzr.php"}).done(function(a){})};var columnCounter=function(){if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*1)+60)){columnCount=1}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*2)+60)){columnCount=2}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*3)+60)){columnCount=3}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*4)+60)){columnCount=4}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*5)+60)){columnCount=5}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*6)+60)){columnCount=6}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*7)+60)){columnCount=7}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*8)+60)){columnCount=8}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*9)+60)){columnCount=9}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*10)+60)){columnCount=10}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*11)+60)){columnCount=11}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*12)+60)){columnCount=12}if(window.innerWidth>(((GRIDSIZE+GUTTERSIZE)*13)+60)){columnCount=13}console.log("columnCount = "+columnCount)};var app=angular.module("app",["ngCookies","ui.utils","ui.sortable"]).controller("MainCtrl",function(d,l,i,h,n){columnCounter();l.threeOpen=false;l.fourOpen=false;l.startUpIndex=0;externalStartUpIndex=0;l.isFocused=false;theContainer.className="modalClear";l.signUp=function(q){if((l.threeOpen===true)&&($(signUpForm.emailSignup).hasClass("ng-valid"))){signingUp=true;signingIn=false;var p=signUpForm.emailSignup.value;var o=signUpForm.passwordSignup.value;localStorage.setItem("user",p);localStorage.setItem("pass",o);hoodie.account.signUp(p,o);console.log(p+" /// "+o)}else{$(signUpForm.emailSignup).focus()}};hoodie.account.on("signup",function(o){l.cells=[];console.log(o);hoodie.store.add("cell",{dimensions:[{},{},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1}],gaze:true,}).done(function(p){l.cells.push(p);cellular=l.cells});hoodie.store.add("cell",{dimensions:[{},{},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1}],wristwatch:true,}).done(function(p){l.cells.push(p);cellular=l.cells});hoodie.store.add("cell",{dimensions:[{},{},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1}],addcell:true,}).done(function(p){l.cells.push(p);cellular=l.cells});hoodie.store.add("cell",{dimensions:[{},{},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1},{sizeX:1,sizeY:1,row:1,col:1}],title:"",body:[{displayed:true,type:"plainText",tabCount:0,content:"This is a bit."},{displayed:true,type:"plainText",tabCount:0,content:"This is another bit!"},{displayed:true,type:"plainText",tabCount:0,content:"Here's another bit..."},{displayed:true,type:"plainText",tabCount:0,content:"And one more for good measure. :)"}],category:1,list:true,}).done(function(p){l.cells.push(p);cellular=l.cells;theContainer.className="yesLetsGo";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway"},550);setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway startingUp"},1000)})});l.signIn=function(){if((l.fourOpen===true)&&(!$(signInForm).hasClass("ng-pristine"))){cellular=l.cells=[];signingIn=true;signupCount=4;m=signInForm.emailSignin.value;k=signInForm.passwordSignin.value;hoodie.account.signIn(m,k);console.log(m+" /// "+k)}else{$(signInForm.emailSignin).focus()}};hoodie.account.on("signin",function(o){if(!signingUp&&(signupCount==4)){localStorage.setItem("user",m);localStorage.setItem("pass",k);hoodie.store.findAll().done(function(p){p.splice(0,1);cellular=l.cells=p;console.log(cellular);theContainer.className="yesLetsGo";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway modalClear";$(signInForm).parents(".four").removeClass("active");l.fourOpen=false},550)})}});if(localStorage.getItem("user")!==null){var m=localStorage.getItem("user");var k=localStorage.getItem("pass");hoodie.account.signIn(m,k);console.log(m+" /// "+k);hoodie.store.findAll().done(function(o){cellular=l.cells=o;console.log(cellular);theContainer.className="yesLetsGo upUpAndAway modalClear"})}l.logOut=function(o){hoodie.account.signOut()};hoodie.account.on("signout",function(o){theContainer.className="";localStorage.removeItem("user");localStorage.removeItem("pass");cellular=l.cells=[]});l.demo=function(){theContainer.className="yesLetsGo upUpAndAway";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway startingUp"},5)};l.changePassword=function(r){var o=$(r.target).parent();var q=passwordChange.oldPassword.value;var p=passwordChange.newPassword.value;hoodie.account.changePassword(q,p);o.addClass("actionComplete");setTimeout(function(){o.removeClass("changingPassword")},3000);setTimeout(function(){o.removeClass("actionComplete")},3200)};l.versionOpener=function(){theContainer.className="yesLetsGo upUpAndAway";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway viewingVersion"},5)};l.aboutOpener=function(){theContainer.className="yesLetsGo upUpAndAway";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway viewingAbout"},5)};l.modalCloser=function(){theContainer.className="yesLetsGo upUpAndAway";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway modalClear"},500)};l.SUB_left=function(){externalStartUpIndex--;l.startUpIndex--;l.startUpPlacer()};l.SUB_right=function(){if(l.startUpIndex>=14){theContainer.className="yesLetsGo upUpAndAway";setTimeout(function(){theContainer.className="yesLetsGo upUpAndAway modalClear";l.startUpIndex=1},500)}else{externalStartUpIndex++;l.startUpIndex++;l.startUpPlacer()}};l.startUpPlacer=function(o){console.log(l.startUpIndex);console.log(o);if(l.startUpIndex===0){}if(l.startUpIndex===1){$theFace=$(".showingList");$theFaceOrigPos=$theFace.offset()}if(l.startUpIndex===4){if(($theFaceOrigPos.left>150)){l.startUpOrient="topRight";l.startUp_X=$theFaceOrigPos.left-260;l.startUp_Y=$theFaceOrigPos.top+210}if(($theFaceOrigPos.left<150)){l.startUpOrient="topLeft";l.startUp_X=$theFaceOrigPos.left+210;l.startUp_Y=$theFaceOrigPos.top+210}}if(l.startUpIndex===5){if(($theFace.offset().left>150)){l.startUpOrient="topRight";l.startUp_X=$theFace.offset().left-260;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}if(($theFace.offset().left<150)){l.startUpOrient="topLeft";l.startUp_X=$theFace.offset().left;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}}if(l.startUpIndex===6){if(($theFace.offset().left>150)){l.startUpOrient="topRight";l.startUp_X=$theFace.offset().left-250;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}if(($theFace.offset().left<150)){l.startUpOrient="topLeft";l.startUp_X=$theFace.offset().left;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}}if(l.startUpIndex===7){$theFace=$(".cellFace.addCell");if(($theFace.offset().left>150)){l.startUpOrient="topRight";l.startUp_X=$theFace.offset().left-250;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}if(($theFace.offset().left<150)){l.startUpOrient="topLeft";l.startUp_X=$theFace.offset().left+210;l.startUp_Y=$theFace.offset().top+$theFace.height()+10}}if(l.startUpIndex===9){l.startUpOrient="leftLeft";l.startUp_X=120;l.startUp_Y=($(window).height()-200)/2}};l.addCell=function(o){hoodie.store.add("cell",{dimensions:[{},{},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2},{sizeX:1,sizeY:1,row:2,col:2}],title:"",body:[{displayed:true,type:"plainText",tabCount:0,content:""}],category:1,list:true}).done(function(p){console.log(l.cells);l.cells.push(p);cellular=l.cells;console.log(l.cells);addFlag=p.id;if(l.startUpIndex===8){l.SUB_right()}})};l.reviver=function(){if(victim==="cell"){var o=JSON.parse(localStorage.getItem("lastRemovedCell"));console.log(o);l.cells.push(o);if(l.startUpIndex===7){l.SUB_right()}}else{if(victim==="bit"){var q=localStorage.getItem("lastRemovedBitParentID");var r=JSON.parse(localStorage.getItem("lastRemovedBit"));var t=localStorage.getItem("lastRemovedBitIndex");var s;for(var p in cellular){if(cellular[p].id==q){s=p}}cellular[s].body.splice(t,0,r)}}victim=""};l.removeCell=function(o){console.log(o);hoodie.store.remove("cell",o).done(function(p){console.log(p);for(var q in l.cells){if(l.cells[q].id===o){localStorage.setItem("lastRemovedCell",JSON.stringify(cellular[q]));victim="cell";l.cells.splice(q,1);cellular=l.cells;if(l.startUpIndex===6){l.SUB_right()}}}})};hoodie.remote.on("update",function(o){a(o)});var a=_.debounce(function(p){console.log("INCOMING UPDATE");console.log(p);console.log("tehUpdated.id = "+p.id);console.log("addFlag = "+addFlag);console.log(l.isFocused);for(var o in cellular){if((cellular[o].id===p.id)&&(p.id!==addFlag)&&(!l.isFocused)){if(!_.isEqual(cellular[o].dimensions,p.dimensions)){cellular[o].dimensions=p.dimensions;console.log(cellular[o].id+" // DIMENSIONS UPDATED")}if(!_.isEqual(cellular[o].body,p.body)){cellular[o].body=p.body;console.log(cellular[o].id+" // BODY UPDATED")}if(cellular[o].title!==p.title){cellular[o].title=p.title;console.log(cellular[o].id+" // TITLE UPDATED")}if(cellular[o].category!==p.category){cellular[o].category=p.category;console.log(cellular[o].id+" // CATEGORY UPDATED")}}else{if(p.id===addFlag){addFlag=undefined}}}},500);hoodie.remote.on("remove",function(p){console.log("INCOMING REMOVE");console.log(p);for(var o in l.cells){if(l.cells[o].id===p.id){l.cells.splice(o,1);cellular=l.cells}}});l.weAreFocused=function(o){l.isFocused=true};l.weAreNotFocused=function(o){l.isFocused=false};var c="https://api.flickr.com/services/rest/?method=flickr.interestingness.getList&api_key=fb4e9edf281bc73c80eb89e1f847b465&format=json&nojsoncallback=1";var j;i.get(c).success(function(o){j=o.photos.photo;f()}).error(function(o){console.log("Error: "+o)});var f=function(){var p=Math.floor(Math.random()*(100-0+1))+0;var o=j[p];var q="http://farm"+o.farm+".staticflickr.com/"+o.server+"/"+o.id+"_"+o.secret+".jpg";l.gaze="url("+q+")"};h(f,600000);var e=function(){navigator.geolocation.getCurrentPosition(function(o){i.get("http://api.openweathermap.org/data/2.5/weather?lat="+o.latitude+"&lon="+o.longitude).success(function(s){console.log(s);l.temp=(s.main.temp-273).toFixed(1);var p=moment();var t=moment.utc(s.sys.sunrise).format();var r=moment.utc(s.sys.sunset).format();var q;if(p.isAfter(t)&&p.isBefore(r)){q="day"}else{q="night"}l.weather="w_"+q+"_"+s.weather[0].id}).error(function(p){console.log("Error: "+p)})})};h(e,600000);e();h(function(){l.time=moment(new Date()).format("H:mm:ss")},1000);l.today=function(){return moment(new Date()).format("dddd")};l.date=function(){return moment(new Date()).format("D MMMM, YYYY")};var g=_.debounce(function(o,p){hoodie.store.update("cell",o,{body:cellular[p].body}).done(function(q){console.log(q);addFlag=q.id})},1000);l.cellEditBody=function(q){var p=$(q.target).find(".textarea-container").last().find("textarea")[0];if(typeof p.selectionStart=="number"){p.selectionStart=p.selectionEnd=p.value.length}else{if(typeof p.createTextRange!="undefined"){p.focus();var o=p.createTextRange();o.collapse(false);o.select()}}};l.textSort={axis:"y",start:function(p,o){p.stopPropagation()},update:function(t,r){console.log(t);console.log(r);var q=t;var p=q.target.parentNode.getAttribute("data-cellid");var s;for(var o in cellular){if(cellular[o].id==p){s=o}}g(p,s);if(l.startUpIndex===1){l.SUB_right()}}};l.cellTitle=function(p){var o=p.target.parentNode.parentNode.parentNode.getAttribute("data-cellid");lazyUpdater(o)};l.bitKiller=function(t){var r=t;var q=r.target.parentNode.parentNode.parentNode.parentNode.getAttribute("data-cellid");var s;for(var p in cellular){if(cellular[p].id==q){s=p}}var o=r.target.parentNode.parentNode.getAttribute("data-index");$(r.target).parent().prev(".textarea-container").find("textarea").focus();localStorage.setItem("lastRemovedBitParentID",q);localStorage.setItem("lastRemovedBit",JSON.stringify(cellular[s].body[o]));localStorage.setItem("lastRemovedBitIndex",o);cellular[s].body.splice(o,1);victim="bit";g(q,s);if(cellular[s].body.length===0){cellular[s].body.push({displayed:true,type:"plainText",tabCount:0,content:""});setTimeout(function(){$(r.target).parent().next(".textarea-container").find("textarea").focus()},50)}if(l.startUpIndex===2){l.SUB_right()}};var b=[];l.areaText=function(x,z){var v=x;b[v.keyCode]=v.type=="keydown";var s=v.target.parentNode.parentNode.parentNode.getAttribute("data-cellid");var D;for(var u in cellular){if(cellular[u].id==s){D=u}}var A=$(v.target)[0].selectionStart;var q=v.target.value;var o=$(v.target).siblings(".sizer");o.html(q.substring(0,A)+'<span class="hiddenCaret"></span>'+q.substring(A,q.length));if(b[8]&&(v.target.value=="")){v.preventDefault();var E=v.target.parentNode.getAttribute("data-index");$(v.target).parent().prev(".textarea-container").find("textarea").focus();cellular[D].body.splice(E,1)}else{if(b[13]){v.preventDefault();var B=parseInt(v.target.parentNode.getAttribute("data-index"))+1;console.log(cellular[D].body.indexOf(z));var p={displayed:true,type:"plainText",tabCount:0,content:""};cellular[D].body.splice(B,0,p);setTimeout(function(){$(v.target).parent().next(".textarea-container").find("textarea").focus()},50)}else{if(b[9]&&b[16]){v.preventDefault();var y=v.target.parentNode.getAttribute("data-index");if(cellular[D].body[y].tabCount>0){cellular[D].body[y].tabCount--}}else{if(b[9]){v.preventDefault();var y=v.target.parentNode.getAttribute("data-index");if(cellular[D].body[y].tabCount<2){cellular[D].body[y].tabCount++}}else{if(b[38]){if(o.find(".hiddenCaret").position().top<14){v.preventDefault();var r=$(v.target).parent().prev(".textarea-container").find("textarea");var C=r.val().length;console.log(C-A);r.focus()[0].setSelectionRange(10000,10000)}}else{if(b[40]){if(o.find(".hiddenCaret").position().top>o.height()-28){v.preventDefault();var t=$(v.target).parent().next(".textarea-container").find("textarea");var w=t.val().length;console.log(w-A);t.focus()[0].setSelectionRange(w-A,w-A)}}}}}}}g(s,D)};l.catSelector=function(t,q){console.log("WHAT");var r=t;r.preventDefault();r.stopPropagation();var p=r.target.parentNode.parentNode.parentNode.getAttribute("data-cellid");var s;for(var o in cellular){if(cellular[o].id==p){cellular[o].category=q}}lazyUpdater(p);if(l.startUpIndex===3){l.SUB_right()}};l.init=function(o){console.log(o)};l.$on("$viewContentLoaded",function(o){console.log(o)});l.aFunction=function(){YEAH}}).directive("resizable",function(a){return function(b){b.initializeWindowSize=_.debounce(function(){b.windowHeight=a.innerHeight;b.windowWidth=a.innerWidth;columnCounter()},200);angular.element(a).bind("resize",function(){b.initializeWindowSize();b.$apply()});b.initializeWindowSize()}}).directive("autonomy",["$rootScope",function(a){return{restrict:"A",scope:{index:"@"},link:function(d,c,b){var f=parseInt(b.index);var h=c[0];if(a.packery===undefined||a.packery===null){a.packery=new Packery(h.parentElement,{gutter:GUTTERSIZE,columnWidth:GRIDSIZE,rowHeight:GRIDSIZE});a.packery.bindResize();a.packery.addItems(h);a.packery.items.splice(1,1)}else{a.packery.addItems(h)}h.style.height=cellular[f].dimensions[columnCount].sizeY*GRIDSIZE;h.style.width=cellular[f].dimensions[columnCount].sizeX*GRIDSIZE;a.packery.fit(c[0],cellular[f].dimensions[columnCount].col*(GRIDSIZE+GUTTERSIZE),cellular[f].dimensions[columnCount].row*(GRIDSIZE+GUTTERSIZE));a.packery.layout();var g=$(h).draggable({handle:".grab",stop:function(i,j){setTimeout(function(){var k=$(h);cellular[f].dimensions[columnCount].col=parseInt(k.css("left"))/(GRIDSIZE+GUTTERSIZE);cellular[f].dimensions[columnCount].row=parseInt(k.css("top"))/(GRIDSIZE+GUTTERSIZE);console.log("MOVED // "+cellular[f].id);lazyUpdater(cellular[f].id);if(externalStartUpIndex===5){setTimeout(function(){$(".SUB_right").click()},500)}},500)}}).resizable({grid:210,stop:function(i,j){setTimeout(function(){var k=$(h);cellular[f].dimensions[columnCount].sizeY=parseInt(k.css("height"))/GRIDSIZE;cellular[f].dimensions[columnCount].sizeX=parseInt(k.css("width"))/GRIDSIZE;console.log("RESIZED // "+cellular[f].id);lazyUpdater(cellular[f].id);if(externalStartUpIndex===4){$(".SUB_right").click()}},500)}});a.packery.bindUIDraggableEvents(g);var e;g.on("resize",function(i,j){if(e){clearTimeout(e)}e=setTimeout(function(){a.packery.fit(j.element[0])},100)})}}}]);